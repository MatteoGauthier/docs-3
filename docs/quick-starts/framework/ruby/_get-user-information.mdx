import FindUserInfoMissing from '../../fragments/_find-user-info-missing.mdx';
import GetUserInfoApis from '../../fragments/_get-user-info-apis.mdx';
import ScopesAndClaims from '../../fragments/_scopes-and-claims.mdx';
import ScopesAndClaimsIntroduction from '../../fragments/_scopes-claims-introduction.md';

<FindUserInfoMissing method="id_token_claims" />

### Request additional claims

<ScopesAndClaimsIntroduction />

To request additional scopes, you can configure the `scopes` option in the `LogtoClient::Config` object:

```ruby
require "logto/client"

@client = LogtoClient.new(
  config: LogtoClient::Config.new(
    # ...other configurations
    # highlight-next-line
    scopes: ["email", "phone"] # Add more scopes as needed
  ),
  # ...other configurations
)
```

Then you can access the additional claims via `id_token_claims`:

```erb title="app/views/sample/index.html.erb"
<% if @client.is_authenticated? %>
  <p>Name: <%= @client.id_token_claims["name"] %></p>
  <p>Email: <%= @client.id_token_claims["email"] %></p>
  <p>Phone: <%= @client.id_token_claims["phone"] %></p>
<% else %>
  <p>Please sign in</p>
<% end %>
```

### Claims that need network requests

To prevent bloating the user object, some claims require network requests to fetch. For example, the `custom_data` claim is not included in the user object even if it's requested in the scopes. To access these claims, you can use the `fetch_user_info` method:

```erb title="app/views/sample/index.html.erb"
<% if @client.is_authenticated? %>
  <p>Custom data: <%= @client.fetch_user_info["custom_data"] %></p>
<!-- ... -->
```

By using the `fetch_user_info` method, the SDK will fetch the user information by requesting to the [userinfo endpoint](https://openid.net/specs/openid-connect-core-1_0.html#UserInfo) after the user is signed in, and `custom_data` will be available once the request is completed.

To learn more about the available scopes and claims, see the [Scopes and claims](#scopes-and-claims) section.

<GetUserInfoApis
  getIdTokenClaimsApi="@client.id_token_claims"
  fetchUserInfoApi="@client.fetch_user_info"
/>

### Scopes and claims

<ScopesAndClaims />
